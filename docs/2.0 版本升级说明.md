# 2.0 版本升级说明

2.0 中包含了若干项功能调整和新增，如下表所示。
- 配置规范调整为使用 Serverless Framework 中 tencent-scf component 规范，详细规范内容可以根据文档中的[配置规范](https://cloud.tencent.com/document/prod[](说tencent-scf component 明文件](https://github.com/serverless-components/tencent-scf/blob/v2/doc/configure.md)
uct/583/38106 )进一步查看。
- Runtime 支持最近新上线的 Nodejs10.15，Nodejs12.16。
- 支持 Nodejs10 及以上版本 runtime 的云函数进行云端调试。

其中配置规范的调整，一定程度上会对原项目造成影响，相关的调整方式、兼容措施、升级方案等说明如下。

## 配置规范调整

配置规范是针对本地项目中用于描述函数相关配置的 yaml 文件的格式规范。在tencent scf vscode 插件的 1.x 版本中，我们使用的是腾讯云自定义的 TCSAM 规范，规范内容可见[TCSAM规范说明](https://github.com/tencentyun/scfcli/blob/master/docs/specs/tencentcloud%20sam%20version%202018-11-11-zh-cn.md)。

为了进一步提升 tencent scf vscode 插件的适用范围，打通产品联动，以及后续提升和扩展更多能力，在 2.0 版本中，我们会切换使用 Serverless Framework 中的配置规范，其中目前兼容的是针对 tencent-scf component 的配置规范，详细规范内容可见[tencent-scf component 规范说明文件](https://github.com/serverless-components/tencent-scf/blob/v2/doc/configure.md)。


### 原有本地项目升级转换

为了便于项目中保留有原有配置规范文件 template.yaml 可以迅速转换到新版本的配置规范文件 serverless.yaml，新版本插件中增加了自动的转换能力。

在本地项目部署到云端时，会自动进行检测，并在缺失 serverless.yaml 文件的情况下，自动生成并填充相关内容，具体内容来源于原有的 template.yaml 文件中的内容。生成的 serverless.yaml 如下所示：

```
component: scf
name: ap-guangzhou_alfredtest2_testvscodec1  ## 生成的项目部署名，由原配置文件中的地域、命名空间、函数名构成
org: '1253970226' ## 部署组织或部署人，由用户 id 组成
app: testvscodec1 ## 使用函数名作为应用名
stage: dev ## 默认设置为 dev
inputs:
  name: testvscodec1  ## 函数名
  src: ./ 
  description: This is a template function
  handler: index.main_handler
  runtime: Python3.6
  namespace: alfredtest2  ## 支持命名空间，不指定、不填写的情况下默认为 default
  region: ap-guangzhou ## 指定部署地域
  memorySize: 128
  timeout: 3
  environment:
    variables:
      ENV_FIRST: env1
      ENV_SECOND: env2
```

> 完成升级后，原有的 template.yaml 文件将不再继续使用，在本地项目中存在 serverless.yaml 的情况下，后续的部署过程均以 serverless.yaml 文件内容为准。请注意在调整配置时使用的文件。


## 云端下载项目升级转换

在从云端下载函数到本地进行编辑开发时，2.0 版本同样会协助进行项目的升级转换。

在下载云端函数到本地时，插件将会检测下载下来的本地项目目录中是否存在新的配置规范文件 serverless.yaml。在本地项目中不存在 serverless.yaml 的情况下，将会从云端下载一份 serverless.yaml 并放置在本地项目中，内容以云端函数的当前配置为准。

同时，下载的项目将以如下的目录结构进行设计并放置函数代码：
```
project
|- src
    |- index.js
    |- other.file
|- serverless.yaml
```