# 云端调试

VS Code 插件支持 Node.js 10.15 及以上版本的 Node.js 运行环境的函数进行在线调试。通过开启在线调试，可以直接在本地的开发环境中查看到远端的代码执行过程、设置断点、单步跟踪、查看堆栈等。

## 使用条件

目前支持运行环境为 Node.js 10.15 的函数开启调试能力，Node.js 12.16的运行环境的支持正在进行中，其他运行环境的支持推进中。

## 开启远程调试

如果是 Runtime 为 Node.js 10及以上版本的函数，可以在云端函数的列表中，函数名右侧看到【函数远程调试】按钮，通过点击调试按钮，可以开启当前函数的远程调试。

![](https://main.qcloudimg.com/raw/4aa7ff40229e69c8025adcdbb9237e1a.png)


在开启远程调试后，VS Code 将切换进入 debugger，并将自动依据如下的调试启动配置来启动调试，其中 `node10debug` 为当前示例的函数名：

```
{
	"version": "0.2.0",
	"configurations": [
		{
			"name": "SCF Remote Debugger for Node10+ - node10debug",
			"type": "node",
			"request": "attach",
			"port": 9222,
			"localRoot": "${workspaceFolder}/node10debug/src",
			"remoteRoot": "/var/user"
		}
	]
}
```

调试启动配置中的 localRoot 将使用当前启动调试函数的具体代码目录，用于映射远端函数代码和本地函数代码。


## 进行远程调试

远程调试启动后，可以通过在本地对应的代码上增加断点，用于中断函数运行并进行后续的调试操作。

在启动调试后，需要按照正常流程触发函数运行。可以通过云端函数列表右侧的【云端调用】，来向云端函数发送触发事件；也可以通过其他方法，例如带有 API 网关触发器的函数，通过访问 URL，同样可以触发函数运行。

在触发运行到断点后，本地调试窗口将可以显示目前中断位置，如下图所示：
![](https://main.qcloudimg.com/raw/f4bd0e5d3806ac73fc5da0ccb4c6221a.png)

同时，也可以通过调试窗口的其他能力，进一步查看当前的变量具体值、增加自身期望监控的变量、当前的调用堆栈。

可以通过 Loaded Scripts 窗口，直接开启远端代码查看及设置断点。

![](https://main.qcloudimg.com/raw/f2216a2c52a20da803f1a0182134c2dd.png)

通过调试的控制按钮，也可以进行调试过程的 Continue、Step Over、Step Out、Step Into 等操作。


## 远程调试使用须知和注意事项

当前云函数的云端调试能力处于 Beta 阶段，欢迎试用并向我们反馈试用中碰到的问题或建议。

在使用云函数的远程调试时，需要了解如下信息或注意点：

1. 远程调试是使用了云函数的一个实际运行并发实例来进行调试。
2. 由于触发事件的随机性，如果有多个实例存在的情况下，触发事件可能随机的落到某个实例上，因此不是任意请求均能命中调试并发实例并可以开始调试。
3. 由于调试断点暂停运行时，长时间未运行且返回的情况下，可能会导致触发端例如 API 网关提示超时。
4. 由于调试断点暂停运行时，实例将仍然处于计时状态，并在此次调试完成，继续执行直到执行完成时，记录耗费的总时长作为此次函数的运行时长。
5. 从触发并发实例运行，到最终完成调试，此次执行完成的最长时间为 900秒，即在调试时如果中断执行 900 秒后，将会强制终止此次执行，并按函数运行 900 秒并超时进行统计和计量。
6. 当前版本的调试能力，会使得云函数超时配置为 900 秒，在正常退出调试时将会重新设置超时为正常值；如果调试命令异常退出或强行终止，会导致云函数超时未能设置为正常值，此时可以通过再次部署（命令行）或手工编辑（控制台）的方式修改云函数的超时配置。


## 关闭远程调试

在关闭 VSCode debugger 时，将会自动关闭远程调试功能。
